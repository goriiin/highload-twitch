# Twitch

## 1. Тема и целевая аудитория

Twitch -  видеостриминговый сервис.

### MVP

1. Регистрация/авторизация
2. Создать стрим
3. Смотреть стрим
4. Подписка на стримера
5. Писать в чат
6. Ставить реакции стриму, лайк/дизлайк 
7. Поиск стримеров по категориям, тегам, ключевым словам
8. Хранение записи стрима
9. Просмотр записи

### Ключевые продуктовые решения

- рекомендации стримов на основе интересов
- бесконечная лента прямых трансляций
- 7 дней хранения записи прямых трансляций для обычных пользователей и 60 дней для партнеров, на количество самих записей в этот период ограничений нет [^5] 
- буферизация прямых трансляций и записей 

### Целевая аудитория

#### Метрики вовлеченности:

- MAU 240M[^1]
- DAU 30M[^1]
- общее количество посещений за январь 2025 - 1.2B [^3]
- В месяц 7M человек запускает стрим хотя бы раз, активных стримеров в день 1.2M [^3]
- одновременно просматривает в среднем 2.5M пользователей, пик 7M [^3]
- одновременное количество прямых трансляций 100K  [^3]
- среднее количество стримов в месяц более 7M  [^3]
- было отправлено более 28B ообщений в чате за год,
   т.е ~80M в день, ~2.33B в месяц (2023 год) [^4]
- на мобильные устройства приходится 35% всех просмотров [^1]
- средняя продолжительность прямой трансляции на Twitch 3 часа[^2]
- смотрят в среднем 1,7B часов контента в месяц  [^3]
- среднее время сессии 36 минут [^7]

#### Рекорды:

- одновременное количество зрителей - 3.44M
- максимальное количество подписчкиков - 19M

#### Распределение аудитории по полу и возрасту:

- 52% пользователей в возрасте 25-34 лет [^2]
- 22% пользователей в возрасте 35-44 лет [^2]
- 72% пользователей - мужчины

#### Распределение аудитории по странам[^2]

| №   | Страна   | Количество пользователей | % от общего числа |
| --- | -------- | ------------------------ | ----------------- |
| 1   | США      | 49.5M                    | 20.6%             |
| 2   | Германия | 16.9M                    | 7.17%             |
| 3   | Россия   | 11.6M                    | 4.85%             |
| 4   | Франция  | 11.44M                   | 4.61%             |
| 5   | Япония   | 10.5M                    | 4.39%             |

## 2. Расчет нагрузки

### Продуктовые метрики
#### Аудитория [^1]

| Тип | Количество |
| --- | ---------- |
| MAU | 240M       |
| DAU | 30M        |

#### Действия пользователя

| Тип                   | Среднее в месяц<br>от 1 юзера | В месяц <br>от всех юзеров   |
| --------------------- | ----------------------------- | ---------------------------- |
|Регистрация/авторизация|  0.05                         | 2M (регистраций) + 12M = 14M |
| Проведение<br>стрима  | 3ч                            | 75M часов                    |
| Просмотр<br>стрима    | 14мин*                        | 1.7B часов [^3]              | 
| Подписки              | 3                             | 720M                         | 
| Сообщения<br>в чате   | 9.7                           | 2.33B  [^4]                  |
| Реакций на<br>стрим   | 1.5                           | 360M                         |
| Поиск                 |  20                           |  4.8B                        |
| Посещения <br>профиля | 4                             |  960M                        |
| Хранение записи       | 3                             | 720M                         |
| Просмотр записи       |  4                            |    960M                      |

- ( \* ) Из расчета, что MAU 240M[^1]

#### Хранилища

##### Пользователя:

| Тип               | Размер |
| ----------------- | ------ |
| Аватарка          | 200КБ  |
| Фото баннер       | 200КБ  |
| Общая информация* | ~2КБ   |
| Итого             | 30МБ   |

- ( \* ) Имя пользователя и отображаемое имя пользователя до 25 символов, информация  о себе до 300 символов, кодировка utf8 - 4б, итого 350 * 4б / 1024 ~ 2КБ
- Максимальный размер загружаемых аватарки/банеров 10МБ, но сжимается до 200КБ

##### Стримера

| Тип                 | Размер   |
| ------------------- | -------- |
| Стримы*             | 716,13ГБ |
| Загружаемые видео** | 397,85ГБ |
| Чат***              | 126Мб    |
| Итого               | 1113.98Гб |


У Twitch нет возможности вести прямую трансляцию в 2к и 4к, это находится на этапе тестирования [^6]. Twitch рекомендует делать трансляцию в 1080р с битрейтом 6000кбит/с [^6] . Средний размер файла на 1минуту с таким разрешением 40МБ. Но так как при просмотре записи Twitch предлагает выбор из качеств видео: 720р60 - в среднем 30МБ/мин, 480 - 11МБ/мин, 360 - 7МБ/мин, 240 - 5МБ/мин, 144 - 3МБ/мин.

Без потери качества можно сжать на 30%

- ( \* ) Итого, если человек ведет прямые трансляции каждый день с средней продолжительностью 3ч, если он партнер Twitch, то запись храниться 60дней. 60 * 3ч * 60мин * (40 + 30 + 11 + 7 + 5 + 4) = 1047600МБ. Итого после сжатия 1047600МБ* 0.7 = 716,13Гб
- ( \** ) Максимум можно сохранить 100ч [^8]  . 100 * 60 * (40 + 30 + 11 + 7 + 5 + 4)МБ = 568,36ГБ. Итого: 568,36ГБ * 0.7 = 397,85
- ( \*** ) Из расчетов действий пользователя получим, что среднее количество сообщений в чате 1100, максимальный размер сообщения 500 символов [^9]  , при кодировке utf8 1100 * 500 * 4Б * 60= 126МБ

### Технические метрики
#### Хранилища

Точных данных по количеству зарезарегистрированных аккаунтов на Twitch нет, при MAU 240M пусть общее количество будет 2.4B (1 к 10).

Из расчета, что 7M активных стримеров в месяц (т.е проводят хотя бы 1 трансляцию в месяц), запись стрима хранится 2 месяца, допустим за 2 месяца будет 10M стримов.

| Тип          | Размер  |
| ------------ | ------- |
| Пользователи | 49.1ТБ  |
| Стримеры     | 1062,37ПБ |
| Итого        | 1 062,42ПБ |

#### Трафик и запросы
Twitch работает по протоколу RTMP [^10] ,  который работает поверх TCP. Раз в секунду делается запрос на получение фрагмента стрима.

| Тип                         | Средний RPS | Сетевой трафик<br>(средний) | Пиковый RPS | Сетевой трафик<br>(пиковый) |
| --------------------------- | ----------- | --------------------------- | ----------- | --------------------------- |
| регистрация<br>/авторизация | 6           | 1200Кбит/с                  | 10          | 2Мбит/с                     |
| Проведение<br>стрима        | 100К        | 0.6Тбит/с                   | 250K        | 1.5Тбит/с                   |
| Просмотр<br>стрима          | 2.5M        | 15Тбит/с                    | 4M          | 60Тбит/с                    |
| Подписки                    | 30K         | 240Мбит/с                   | 150K        | 1.2Гбит/с                   |
| Чат                         | 300K        | 240Мбит/с                   | 1M          | 800Мбит/с                   |
| Реакции                     | 30K         | 120Мбит/с                   | 200K        | 800Мбит/с                   |
| Поиск                       | 2K          | 2Мбит/с                     | 3К          | 3Мбит/c                     |
| Переход <br>в профиль       | 10K         | 0.8Гбит/с                   | 20K         | 1.6Гбит/с                   |
| Хранение записи             | 300         | 1,72Гбит/с                  | 450         | 2,57Гбит/с                  |
| Просмотр записи             | 400         | 2,29Гбит/с                  | 600         | 3,43Гбит/с                  |
| Итого                       | 2.97M       | 15.6Тбит/с                  | 8.65M       | 62,7Тбит/с                  |

## Источники
[^1]:  https://www.demandsage.com/twitch-users
[^2]: https://analyzify.com/statsup/twitch
[^3]: https://twitchtracker.com/statistics
[^4]: https://leftronic.com/blog/twitch-statistics
[^5]: https://help.twitch.tv/s/article/video-on-demand?language=ru
[^6]: https://help.twitch.tv/s/article/multiple-encodes?language=ru
[^7]: https://www.sostav.ru/publication/twitch-49828.html
[^8]: https://au.finance.yahoo.com/news/twitch-caps-streamers-storage-100-150858673.html
[^9]:  https://discuss.dev.twitch.com/t/message-character-limit/7793
[^10]: https://help.twitch.tv/s/article/guide-to-using-twitch-inspector?language=ru

